ALTER SESSION SET CONTAINER = green_it_pdb;
--Staging Table Creation (Raw Data Layer)
-- Create the Staging Table in its dedicated tablespace
-- Best Practice: No constraints allowed here to facilitate bulk loading
CREATE TABLE GREEN_IT_OWNER.STG_GREEN_WORKLOAD (
    record_id               VARCHAR2(50),
    workload_type           VARCHAR2(100),
    compute_demand          NUMBER,
    storage_demand          NUMBER,
    network_demand          NUMBER,
    energy_source           VARCHAR2(100),
    energy_consumption      NUMBER,
    renewable_share         NUMBER,
    carbon_emissions        NUMBER,
    qso_optimization        NUMBER,
    uncertainty_factor      NUMBER,
    security_level          VARCHAR2(50),
    pqc_enabled             NUMBER, -- Boolean as 0 or 1
    energy_efficiency       NUMBER,
    service_quality         NUMBER,
    secure_ops_score        NUMBER,
    workload_scenario       VARCHAR2(100),
    scenario_strategy       VARCHAR2(100),
    operational_cost        NUMBER,
    performance_metric      NUMBER
) TABLESPACE TS_GREEN_STAGING;


-- The Star Schema Implementation
--1.Dimension Tables
-- DIM_WORKLOAD: In TS_DIM_WORKLOAD
CREATE TABLE GREEN_IT_OWNER.DIM_WORKLOAD (
    workload_key    NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    record_id       VARCHAR2(50), -- Original ID from CSV
    workload_type   VARCHAR2(100)
) TABLESPACE TS_DIM_WORKLOAD;

--  DIM_ENERGY: In TS_DIM_ENERGY
CREATE TABLE GREEN_IT_OWNER.DIM_ENERGY (
    energy_key      NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    energy_source   VARCHAR2(100),
    renewable_flag  NUMBER(1) -- 1 for True, 0 for False
) TABLESPACE TS_DIM_ENERGY;

-- DIM_SECURITY: In TS_DIM_SECURITY
CREATE TABLE GREEN_IT_OWNER.DIM_SECURITY (
    security_key    NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    security_level  VARCHAR2(50),
    pqc_enabled     NUMBER(1)
) TABLESPACE TS_DIM_SECURITY;

-- DIM_SCENARIO: In TS_DIM_SCENARIO
CREATE TABLE GREEN_IT_OWNER.DIM_SCENARIO (
    scenario_key       NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    workload_scenario  VARCHAR2(100),
    scenario_strategy  VARCHAR2(100)
) TABLESPACE TS_DIM_SCENARIO;

--2. The Fact Table (Center of the Star)
-- FACT_GREEN_WORKLOAD: In TS_FACT_GREEN
CREATE TABLE GREEN_IT_OWNER.FACT_GREEN_WORKLOAD (
    fact_key                NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    -- Foreign Keys
    workload_key           NUMBER REFERENCES GREEN_IT_OWNER.DIM_WORKLOAD(workload_key),
    energy_key             NUMBER REFERENCES GREEN_IT_OWNER.DIM_ENERGY(energy_key),
    security_key           NUMBER REFERENCES GREEN_IT_OWNER.DIM_SECURITY(security_key),
    scenario_key           NUMBER REFERENCES GREEN_IT_OWNER.DIM_SCENARIO(scenario_key),
    -- Metrics (Quantitative Data)
    compute_demand_TFlops   NUMBER,
    storage_demand_TB       NUMBER,
    network_demand_Gbps     NUMBER,
    energy_consumption_kWh  NUMBER,
    carbon_emissions_kgCO2  NUMBER,
    operational_cost_usd    NUMBER,
    performance_metric      NUMBER,
    -- Audit Column (Professional Practice)
    load_date              DATE DEFAULT SYSDATE
) TABLESPACE TS_FACT_GREEN;

COMMIT;