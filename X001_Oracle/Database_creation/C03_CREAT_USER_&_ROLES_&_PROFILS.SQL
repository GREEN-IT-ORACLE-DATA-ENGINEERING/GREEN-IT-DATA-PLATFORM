ALTER SESSION SET CONTAINER = green_it_pdb;
--1.Detailed Security Profiles
-- Profile for PDB_ADMIN (Maximum Authority)
CREATE PROFILE PROF_GREEN_PDBA LIMIT
    SESSIONS_PER_USER          5
    CPU_PER_SESSION            UNLIMITED
    IDLE_TIME                  UNLIMITED
    FAILED_LOGIN_ATTEMPTS      3
    PASSWORD_LIFE_TIME         90
    PASSWORD_REUSE_TIME        365
    PASSWORD_GRACE_TIME        7;

-- Profile for GREEN_IT_OWNER (Developer/DBA)
CREATE PROFILE PROF_GREEN_OWNER LIMIT
    SESSIONS_PER_USER          5
    CPU_PER_SESSION            UNLIMITED
    IDLE_TIME                  30          -- 30 mins idle timeout
    FAILED_LOGIN_ATTEMPTS      5
    PASSWORD_LIFE_TIME         60          -- Change every 2 months
    PASSWORD_REUSE_TIME        180
    PASSWORD_REUSE_MAX         3           -- Cannot reuse last 3 passwords
    PASSWORD_GRACE_TIME        7;

-- Profile for GREEN_IT_DB_READER (End User)
CREATE PROFILE PROF_GREEN_READER LIMIT
    SESSIONS_PER_USER          2
    CPU_PER_SESSION            10000       -- Limit CPU usage for safety
    IDLE_TIME                  15          -- 15 mins idle timeout
    FAILED_LOGIN_ATTEMPTS      5
    PASSWORD_LIFE_TIME         30
    PASSWORD_GRACE_TIME        3;

--2. Role-Based Access Control (RBAC)
-- Role for the PDB Admin
CREATE ROLE ROLE_GREEN_PDBA;
GRANT ALL PRIVILEGES TO ROLE_GREEN_PDBA;

-- Role for the Owner (As requested: Session, Index, CRUD, View)
CREATE ROLE ROLE_GREEN_OWNER;
GRANT CREATE SESSION, CREATE TABLE, CREATE VIEW, CREATE ANY INDEX, 
INSERT ANY TABLE, UPDATE ANY TABLE, DELETE ANY TABLE,
CREATE SEQUENCE, CREATE PROCEDURE TO ROLE_GREEN_OWNER;

-- Role for the Reader
CREATE ROLE ROLE_GREEN_READER;
GRANT CREATE SESSION TO ROLE_GREEN_READER;

--3. User Creation with GREEN_IT Prefix
-- 1. The PDB Admin
CREATE USER GREEN_IT_PDB_ADMIN IDENTIFIED BY "PdbAdmin_2026_#"
DEFAULT TABLESPACE TS_FACT_GREEN
PROFILE PROF_GREEN_PDBA;
GRANT ROLE_GREEN_PDBA TO GREEN_IT_PDB_ADMIN;

-- 2. The Owner (Schema Creator)
CREATE USER GREEN_IT_OWNER IDENTIFIED BY "Owner_2026_#IT"
DEFAULT TABLESPACE TS_FACT_GREEN
PROFILE PROF_GREEN_OWNER;
GRANT ROLE_GREEN_OWNER TO GREEN_IT_OWNER;

-- 3. The Reader
CREATE USER GREEN_IT_DB_READER IDENTIFIED BY "Reader_2026_#IT"
DEFAULT TABLESPACE TS_FACT_GREEN
PROFILE PROF_GREEN_READER;
GRANT ROLE_GREEN_READER TO GREEN_IT_DB_READER;

-- Essential: Give Owner space to work
ALTER USER GREEN_IT_OWNER QUOTA UNLIMITED ON TS_GREEN_STAGING;
ALTER USER GREEN_IT_OWNER QUOTA UNLIMITED ON TS_DIM_WORKLOAD;
ALTER USER GREEN_IT_OWNER QUOTA UNLIMITED ON TS_DIM_ENERGY;
ALTER USER GREEN_IT_OWNER QUOTA UNLIMITED ON TS_DIM_SECURITY;
ALTER USER GREEN_IT_OWNER QUOTA UNLIMITED ON TS_DIM_SCENARIO;
ALTER USER GREEN_IT_OWNER QUOTA UNLIMITED ON TS_FACT_GREEN;
ALTER USER GREEN_IT_OWNER QUOTA UNLIMITED ON TS_GREEN_ARCHIVE;

COMMIT;

